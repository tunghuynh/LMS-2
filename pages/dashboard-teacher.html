<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - LMS</title>
    <!-- Core CSS -->
    <link rel="stylesheet" href="../assets/css/global.css">
    <link rel="stylesheet" href="../assets/css/themes.css">
    <link rel="stylesheet" href="../assets/css/layout.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/utilities.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stat-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-5);
        }
        
        .stat-card__icon {
            width: 56px;
            height: 56px;
            background: var(--color-primary-lighter);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-3);
            color: var(--color-primary);
            font-size: 1.5rem;
        }
        
        .stat-card__value {
            font-size: 2rem;
            font-weight: var(--font-weight-bold);
            margin: var(--spacing-1) 0;
        }
        
        .stat-card__label {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .stat-card__trend {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-1);
            font-size: var(--font-size-sm);
            margin-top: var(--spacing-2);
        }
        
        .stat-card__trend--up {
            color: var(--color-success);
        }
        
        .stat-card__trend--down {
            color: var(--color-danger);
        }
        
        .student-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-3);
            border-bottom: 1px solid var(--border-color);
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        .student-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            background: var(--bg-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .schedule-item {
            display: flex;
            gap: var(--spacing-3);
            padding: var(--spacing-3);
            background: var(--bg-base);
            border-radius: var(--radius-base);
            margin-bottom: var(--spacing-3);
            border-left: 4px solid var(--color-primary);
        }
        
        .schedule-time {
            font-weight: var(--font-weight-medium);
            color: var(--color-primary);
            min-width: 80px;
        }
        
        .submission-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-3);
            background: var(--bg-base);
            border-radius: var(--radius-base);
            margin-bottom: var(--spacing-2);
        }
        
        .question-item {
            padding: var(--spacing-3);
            background: var(--bg-base);
            border-radius: var(--radius-base);
            margin-bottom: var(--spacing-3);
        }
        
        .course-stat-card {
            padding: var(--spacing-4);
            background: var(--bg-base);
            border-radius: var(--radius-base);
            text-align: center;
        }
        
        .course-stat-card__icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-2);
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Welcome Header -->
        <div class="page-header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: var(--spacing-4);">
                <div>
                    <h1 class="page-title">
                        <span data-translate="dashboard.welcome">Welcome back</span>, 
                        <span id="userName">Teacher</span>!
                    </h1>
                    <p class="page-subtitle" data-translate="dashboard.teacherSubtitle">
                        Manage your courses and track student progress
                    </p>
                </div>
                <div style="display: flex; gap: var(--spacing-3);">
                    <button class="btn btn--primary" onclick="createCourse()">
                        <i class="fas fa-plus"></i>
                        <span data-translate="dashboard.createCourse">Create Course</span>
                    </button>
                    <button class="btn btn--secondary" onclick="viewAnalytics()">
                        <i class="fas fa-chart-bar"></i>
                        <span data-translate="dashboard.viewAnalytics">View Analytics</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="page-content">
            <!-- Stats Overview -->
            <div class="grid grid--4-cols" style="gap: var(--spacing-4); margin-bottom: var(--spacing-6);">
                <div class="stat-card">
                    <div class="stat-card__icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-card__value" id="totalStudents">0</div>
                    <div class="stat-card__label" data-translate="dashboard.totalStudents">Total Students</div>
                    <div class="stat-card__trend stat-card__trend--up">
                        <i class="fas fa-arrow-up"></i>
                        <span>12% this month</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card__icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-card__value" id="activeCourses">0</div>
                    <div class="stat-card__label" data-translate="dashboard.activeCourses">Active Courses</div>
                    <div class="stat-card__trend">
                        <span>+2 new</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card__icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="stat-card__value" id="pendingGrades">0</div>
                    <div class="stat-card__label" data-translate="dashboard.pendingGrades">Pending Grades</div>
                    <div class="stat-card__trend">
                        <span class="text-warning">Needs attention</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-card__icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="stat-card__value" id="avgRating">0.0</div>
                    <div class="stat-card__label" data-translate="dashboard.avgRating">Average Rating</div>
                    <div class="stat-card__trend stat-card__trend--up">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0.3</span>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid" style="grid-template-columns: 2fr 1fr; gap: var(--spacing-6);">
                <!-- Left Column -->
                <div>
                    <!-- Course Performance -->
                    <div class="card" style="margin-bottom: var(--spacing-6);">
                        <div class="card__header">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 data-translate="dashboard.coursePerformance">Course Performance</h3>
                                <select class="input input--small" style="width: 150px;" onchange="updateCourseStats()">
                                    <option>All Courses</option>
                                    <option>JavaScript 101</option>
                                    <option>React Advanced</option>
                                    <option>Python Basics</option>
                                </select>
                            </div>
                        </div>
                        <div class="card__body">
                            <div class="grid grid--4-cols" style="gap: var(--spacing-4); margin-bottom: var(--spacing-4);">
                                <div class="course-stat-card">
                                    <div class="course-stat-card__icon">üë•</div>
                                    <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold);">156</div>
                                    <div class="text-secondary" style="font-size: var(--font-size-sm);">Enrolled</div>
                                </div>
                                <div class="course-stat-card">
                                    <div class="course-stat-card__icon">üìä</div>
                                    <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold);">78%</div>
                                    <div class="text-secondary" style="font-size: var(--font-size-sm);">Avg Progress</div>
                                </div>
                                <div class="course-stat-card">
                                    <div class="course-stat-card__icon">‚úÖ</div>
                                    <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold);">92</div>
                                    <div class="text-secondary" style="font-size: var(--font-size-sm);">Completed</div>
                                </div>
                                <div class="course-stat-card">
                                    <div class="course-stat-card__icon">‚≠ê</div>
                                    <div style="font-size: 1.5rem; font-weight: var(--font-weight-bold);">4.6</div>
                                    <div class="text-secondary" style="font-size: var(--font-size-sm);">Rating</div>
                                </div>
                            </div>
                            <div style="position: relative; height: 300px;">
                                <canvas id="studentProgressChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Submissions -->
                    <div class="card" style="margin-bottom: var(--spacing-6);">
                        <div class="card__header">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 data-translate="dashboard.recentSubmissions">Recent Submissions</h3>
                                <a href="submissions.html" class="link">
                                    <span data-translate="common.viewAll">View All</span>
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </div>
                        <div class="card__body">
                            <div id="submissionsContainer">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>

                    <!-- Top Performing Students -->
                    <div class="card">
                        <div class="card__header">
                            <h3 data-translate="dashboard.topStudents">Top Performing Students</h3>
                        </div>
                        <div class="card__body">
                            <div id="topStudentsContainer">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div>
                    <!-- Today's Schedule -->
                    <div class="card" style="margin-bottom: var(--spacing-6);">
                        <div class="card__header">
                            <h3 data-translate="dashboard.todaySchedule">Today's Schedule</h3>
                            <p class="text-secondary" id="currentDate">Monday, Dec 18</p>
                        </div>
                        <div class="card__body">
                            <div id="scheduleContainer">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>

                    <!-- Student Questions -->
                    <div class="card" style="margin-bottom: var(--spacing-6);">
                        <div class="card__header">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h3 data-translate="dashboard.studentQuestions">Student Questions</h3>
                                <span class="badge badge--danger" id="questionCount">3</span>
                            </div>
                        </div>
                        <div class="card__body">
                            <div id="questionsContainer">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card">
                        <div class="card__header">
                            <h3 data-translate="dashboard.quickActions">Quick Actions</h3>
                        </div>
                        <div class="card__body">
                            <div style="display: flex; flex-direction: column; gap: var(--spacing-3);">
                                <button class="btn btn--secondary" onclick="createQuiz()" style="justify-content: flex-start;">
                                    <i class="fas fa-question-circle" style="width: 20px;"></i>
                                    <span data-translate="dashboard.createQuiz">Create Quiz</span>
                                </button>
                                <button class="btn btn--secondary" onclick="uploadLesson()" style="justify-content: flex-start;">
                                    <i class="fas fa-upload" style="width: 20px;"></i>
                                    <span data-translate="dashboard.uploadLesson">Upload Lesson</span>
                                </button>
                                <button class="btn btn--secondary" onclick="sendAnnouncement()" style="justify-content: flex-start;">
                                    <i class="fas fa-bullhorn" style="width: 20px;"></i>
                                    <span data-translate="dashboard.sendAnnouncement">Send Announcement</span>
                                </button>
                                <button class="btn btn--secondary" onclick="viewReports()" style="justify-content: flex-start;">
                                    <i class="fas fa-file-alt" style="width: 20px;"></i>
                                    <span data-translate="dashboard.viewReports">View Reports</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Core JavaScript -->
    <script src="../config.js"></script>
    <script src="../assets/js/global.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/api.js"></script>
    <script>
        // Dashboard data
        let dashboardData = {
            user: null,
            courses: [],
            students: [],
            submissions: []
        };

        // Initialize dashboard
        async function init() {
            // Check authentication
            if (!LMS.AccessControl.checkRole('teacher')) {
                return;
            }
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));

            // Initialize language
            await LMS.LanguageManager.init();
            LMS.LanguageManager.updateUI();

            // Set user name
            document.getElementById('userName').textContent = currentUser.fullName || currentUser.username;

            // Set current date
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('en', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });

            // Load dashboard data
            loadDashboardData();
        }

        // Load dashboard data
        async function loadDashboardData() {
            // Mock data
            const stats = {
                totalStudents: 245,
                activeCourses: 6,
                pendingGrades: 12,
                avgRating: 4.5
            };

            // Update stats
            document.getElementById('totalStudents').textContent = stats.totalStudents;
            document.getElementById('activeCourses').textContent = stats.activeCourses;
            document.getElementById('pendingGrades').textContent = stats.pendingGrades;
            document.getElementById('avgRating').textContent = stats.avgRating.toFixed(1);

            // Load other data
            loadStudentProgressChart();
            loadRecentSubmissions();
            loadTopStudents();
            loadTodaySchedule();
            loadStudentQuestions();
        }

        // Load student progress chart
        function loadStudentProgressChart() {
            const ctx = document.getElementById('studentProgressChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
                    datasets: [{
                        label: 'Average Progress',
                        data: [20, 35, 45, 60, 75, 78],
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary'),
                        backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--color-primary') + '20',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Completion Rate',
                        data: [10, 25, 30, 45, 55, 60],
                        borderColor: getComputedStyle(document.documentElement).getPropertyValue('--color-success'),
                        backgroundColor: getComputedStyle(document.documentElement).getPropertyValue('--color-success') + '20',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load recent submissions
        function loadRecentSubmissions() {
            const submissions = [
                {
                    student: 'Alex Johnson',
                    assignment: 'React Hooks Assignment',
                    course: 'React Advanced',
                    time: '2 hours ago',
                    status: 'pending'
                },
                {
                    student: 'Sarah Davis',
                    assignment: 'JavaScript Functions Quiz',
                    course: 'JavaScript 101',
                    time: '4 hours ago',
                    status: 'graded'
                },
                {
                    student: 'Mike Chen',
                    assignment: 'Python Project',
                    course: 'Python Basics',
                    time: 'Yesterday',
                    status: 'pending'
                }
            ];

            const container = document.getElementById('submissionsContainer');
            container.innerHTML = submissions.map(submission => `
                <div class="submission-item">
                    <div>
                        <div style="font-weight: var(--font-weight-medium);">${submission.assignment}</div>
                        <div class="text-secondary" style="font-size: var(--font-size-sm);">
                            ${submission.student} ‚Ä¢ ${submission.course} ‚Ä¢ ${submission.time}
                        </div>
                    </div>
                    ${submission.status === 'pending' ? 
                        `<button class="btn btn--primary btn--small" onclick="gradeSubmission()">Grade</button>` : 
                        `<span class="badge badge--success">Graded</span>`
                    }
                </div>
            `).join('');
        }

        // Load top students
        function loadTopStudents() {
            const students = [
                { name: 'Emma Wilson', avatar: 'üë©', score: 95, progress: 100 },
                { name: 'James Brown', avatar: 'üë®', score: 92, progress: 98 },
                { name: 'Lisa Anderson', avatar: 'üë©', score: 90, progress: 95 },
                { name: 'David Lee', avatar: 'üë®', score: 88, progress: 92 },
                { name: 'Maria Garcia', avatar: 'üë©', score: 87, progress: 90 }
            ];

            const container = document.getElementById('topStudentsContainer');
            container.innerHTML = students.map((student, index) => `
                <div class="student-item">
                    <div style="display: flex; align-items: center; gap: var(--spacing-2); font-weight: var(--font-weight-medium); min-width: 30px;">
                        ${index + 1}
                    </div>
                    <div class="student-avatar">${student.avatar}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: var(--font-weight-medium);">${student.name}</div>
                        <div style="display: flex; gap: var(--spacing-4); margin-top: var(--spacing-1);">
                            <span class="text-secondary" style="font-size: var(--font-size-sm);">
                                <i class="fas fa-trophy text-warning"></i> ${student.score}%
                            </span>
                            <span class="text-secondary" style="font-size: var(--font-size-sm);">
                                <i class="fas fa-chart-line text-primary"></i> ${student.progress}%
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load today's schedule
        function loadTodaySchedule() {
            const schedule = [
                {
                    time: '09:00 AM',
                    title: 'JavaScript Fundamentals',
                    type: 'Live Class',
                    students: 45
                },
                {
                    time: '11:00 AM',
                    title: 'Office Hours',
                    type: 'Q&A Session',
                    students: 'Open'
                },
                {
                    time: '02:00 PM',
                    title: 'React Components',
                    type: 'Live Class',
                    students: 38
                },
                {
                    time: '04:00 PM',
                    title: 'Quiz Review',
                    type: 'Review Session',
                    students: 25
                }
            ];

            const container = document.getElementById('scheduleContainer');
            container.innerHTML = schedule.map(item => `
                <div class="schedule-item">
                    <div class="schedule-time">${item.time}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: var(--font-weight-medium);">${item.title}</div>
                        <div class="text-secondary" style="font-size: var(--font-size-sm);">
                            ${item.type} ‚Ä¢ ${item.students === 'Open' ? 'Open' : `${item.students} students`}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load student questions
        function loadStudentQuestions() {
            const questions = [
                {
                    student: 'Tom Wilson',
                    question: 'Can you explain arrow functions again?',
                    course: 'JavaScript 101',
                    time: '1 hour ago'
                },
                {
                    student: 'Amy Chen',
                    question: 'Having trouble with useState hook',
                    course: 'React Advanced',
                    time: '3 hours ago'
                },
                {
                    student: 'John Smith',
                    question: 'Need help with the final project',
                    course: 'Python Basics',
                    time: 'Yesterday'
                }
            ];

            const container = document.getElementById('questionsContainer');
            container.innerHTML = questions.map(question => `
                <div class="question-item">
                    <div style="font-weight: var(--font-weight-medium); margin-bottom: var(--spacing-1);">
                        ${question.student}
                    </div>
                    <div style="margin-bottom: var(--spacing-2);">${question.question}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span class="text-secondary" style="font-size: var(--font-size-sm);">
                            ${question.course} ‚Ä¢ ${question.time}
                        </span>
                        <button class="btn btn--ghost btn--small" onclick="replyToQuestion()">
                            Reply
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Navigation functions
        function createCourse() {
            window.location.href = 'course-create.html';
        }

        function viewAnalytics() {
            window.location.href = 'analytics.html';
        }

        function createQuiz() {
            window.location.href = 'quiz-builder.html';
        }

        function uploadLesson() {
            window.location.href = 'lesson-builder.html';
        }

        function sendAnnouncement() {
            LMS.showToast('Announcement feature coming soon!', 'info');
        }

        function viewReports() {
            window.location.href = 'reports.html';
        }

        function gradeSubmission() {
            LMS.showToast('Opening grading interface...', 'info');
        }

        function replyToQuestion() {
            LMS.showToast('Opening message interface...', 'info');
        }

        function updateCourseStats() {
            // Update stats based on selected course
            LMS.showToast('Updating statistics...', 'info');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            init();
        });
    </script>
</body>
</html>
